{% extends "bodybase.html.twig" %}

{% block bodycontainer %}
<h1>{{ course.getName() }}</h1>
<div class="content-container">
    <div class="body-panel">
        <div class="course-page">
            {% if listening is defined %}
            <div class="course-listening">
                <div class="listening-progress">
                    <span class="label">{{ "student_courses.course_info.progress"|trans }}</span>
                    <div class="course-progress">
                        <span class="chapters">{{ completedChaptersCount}}/{{ totalChaptersCount }}</span>
                        <div class="progress-bar">
                            <div class="bar" style="width:{{ totalChaptersCount > 0 ? (completedChaptersCount / totalChaptersCount) * 100 : 0 }}%;"></div>
                        </div>
                    </div>
                </div>
                {% if listening.groupCourse and listening.groupCourse.active %}
                <div class="listen-course">
                    <a href="{{ path("elearning_course_listen", {'listening_id':listening.id, 'next':'next'}) }}" class="btn btn-orange">{{ "student_courses.course_info.to_course_listen"|trans }}</a>
                </div>
                {% endif %}
            </div>
            {% endif %}
            <div class="course-info">
                <div class="course-description">
                    <div class="course-image">
                        <img src="{{ course.getWebPath() }}" />
                    </div>
                    <div class="description">
                        <div class="category">
                            {{ "student_courses.course_info.course_category"|trans }}
                            <span class="category-title">{{ course.category.name }}</a>
                        </div>
                        <div class="description-content">
                            <div class="title">{{ "student_courses.course_info.about_course"|trans }}</div>
                            <div class="content">
                                {% autoescape false %}
                                    {{ course.description }}
                                {% endautoescape %}
                            </div>
                        </div>
                    </div>
                </div>
                {% if course.uploads|length > 0 %}
                <div class="course-files">
                    <h2>{{ "student_courses.course_info.course_files"|trans }}</h2>
                    <div class="files">
                        <table class="table table-striped table-bordered">
                            <thead>
                                <tr>
                                    <th>{{ "new_course.form.course_files_popup.filename"|trans }}</th>
                                    <th>{{ "new_course.form.course_files_popup.filesize"|trans }}</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for file in course.getUploads() %}
                                <tr data-id="{{ file.id }}">
                                    <td>
                                        <a href="{{ path("elearning_courses_show_course_file_student", {'id':file.id}) }}" target="_blank">{{ file.originalFilename }}</a>
                                    </td>
                                    <td>{{ file.filesize / 1000 }} kB</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
                {% endif %}
                {% if faq is not empty %}
                <div class="faq">
                    <h2>
                        {{ "student_courses.course_info.frequently_asked_questions"|trans }}
                    </h2>
                    <div class="questions">
                        {% for question in faq %}
                            <div class="question">
                                <div class="header">
                                    <span class="question-text">{{ question.question }}</span>
                                    <a href="#" class="toggle-question"></a>
                                </div>
                                <div class="answer">
                                    {{ question.answer }}
                                </div>
                            </div>
                        {% endfor %}
                    </div>
                </div>
                {% endif %}

                <div class="your-questions">
                    <h2>
                        {{ "student_courses.course_info.your_questions"|trans }}
                    </h2>

                    {% if myquestions is not empty %}
                    <div class="question-items">
                        {% for question in myquestions %}
                            <div class="item">
                                <div class="question">
                                    <div class="question-container">
                                        <div class="content">
                                            {{ question.question }}
                                        </div>
                                    </div>
                                    <div class="time">
                                    {{ question.createdtime|date("Y-m-d H:i:s") }}
                                    </div>
                                </div>
                                {% if question.answer is not empty %}
                                <div class="answer">
                                    <div class="time">
                                    {{ question.answeredtime|date("Y-m-d H:i:s") }}
                                    </div>
                                    <div class="answer-container">
                                        <div class="content">
                                            {{ question.answer }}
                                        </div>
                                    </div>
                                </div>
                                {% endif %}
                            </div>
                        {% endfor %}
                    </div>
                    {% endif %}
                    {% if listening is defined %}
                    <div class="ask-question">
                    <form action="{{ path("elearning_courses_ask_question", {'listening_id': listening.id}) }}" method="post">
                        <div class="form-group">
                            <label>{{ "student_courses.course_info.ask_question"|trans }}</label>
                            <textarea class="form-control" name="question" rows="5" placeholder="{{ "student_courses.course_info.question.write_here"|trans }}"></textarea>
                        </div>
                        <div class="form-group submit">
                            <input type="submit" class="btn btn-orange" value="{{ "student_courses.course_info.question.send"|trans }}" />
                        </div>
                    </form>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block stylesheets %}
    {% stylesheets '@ElearningCoursesBundle/Resources/less/styles.less'
    '@ElearningCoursesBundle/Resources/less/responsive.less' %}
        <link rel="stylesheet" href="{{ asset_url }}">
    {% endstylesheets %}
{% endblock %}

{% block javascripts %}
{{ parent() }}
<script>
jQuery(function($){
    $('.questions .question .header').on('click', function(e){
        e.preventDefault();
        $(this).parents('.question').toggleClass('open');
    });
});
</script>
{% endblock %}
