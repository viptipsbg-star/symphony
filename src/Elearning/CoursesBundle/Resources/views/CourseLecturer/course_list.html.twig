{% extends "bodybase.html.twig" %}


{% block bodycontainer %}
    <h1>{{ "course_list.title"|trans }}</h1>
    <div class="content-container">
        <div class="head-panel">
            <div class="filters">
                <form class="form-inline">
                    <div class="form-group">
                        <select class="status-filter form-control" name="filter[status]">
                            <option disabled
                                    {% if filter['status'] is empty %}selected{% endif %}>{{ "course_list.filter.status"|trans }}</option>
                            <option value="">{{ "course_list.filter.all"|trans }}</option>
                            <option value="published"
                                    {% if filter['status'] == "published" %}selected{% endif %}>{{ "course_list.filter.published"|trans }}</option>
                            <option value="initiated"
                                    {% if filter['status'] == "unpublished" %}selected{% endif %}>{{ "course_list.filter.unpublished"|trans }}</option>
                            <option value="trash"
                                    {% if filter['status'] == "trash" %}selected{% endif %}>{{ "course_list.filter.trash"|trans }}</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <input type="submit" value="{{ "course_list.filter.filter"|trans }}" class="btn btn-brown"/>
                    </div>
                </form>
            </div>
            <div class="new">
                <a href="{{ path("elearning_courses_new") }}"
                   class="btn btn-orange">{{ "course_list.new_course"|trans }}</a>
            </div>
        </div>
        <div class="body-panel">
            <form action="#" id="adminForm" method="post" name="adminForm">
                <div class="list-table">
                    <table class="table table-striped table-bordered courses-table">
                        <thead>
                        <tr>
                            {% if is_granted('ROLE_SUPERVISOR') %}
                                <th></th>
                            {% endif %}
                            <th>{{ "course_list.course.name"|trans }}</th>
                            <th>{{ "course_list.course.category"|trans }}</th>
                            <th>{{ "course_list.course.status"|trans }}</th>
                            <th>{{ "course_list.course.questions"|trans }}</th>
                            <th>{{ "course_list.course.faq"|trans }}</th>
                            <th>{{ "course_list.course.feedbacks"|trans }}</th>
                            <th></th>
                        </tr>
                        </thead>
                        <tbody>
                        {% for course in courses %}
                            <tr>
                                {% if is_granted('ROLE_SUPERVISOR') %}
                                    <td>
                                        <a href="#" class="sortable-handle"><span
                                                    class="glyphicon glyphicon-resize-vertical"
                                                    aria-hidden="true"></span></a>
                                        <input type="text" name="order[]" value="{{ course.getOrdering() }}"
                                               style="display:none"/>
                                        <input type="checkbox" value="{{ course.id }}" name="cid[]" style="display:none"/>
                                    </td>
                                {% endif %}
                                <td>{{ course.getName() }}</td>
                                <td>{{ course.getCategory().getName() }}</td>
                                <td>
                                    {% if course.status == "trash" %}
                                        <span class="state state-red">
                                    {{ "course_list.states.trashed"|trans }}
                                </span>
                                    {% elseif course.status == "published" %}
                                        {% if course.activeDateTo and course.activeDateTo < date()  %}
                                            <span class="state state-blue">
                                            {{ "course_list.states.expired"|trans }}
                                        {% else %}
                                            <span class="state state-green">
                                            {{ "course_list.states.published"|trans }}
                                        {% endif %}
                                </span>
                                    {% elseif course.status == "unpublished" %}
                                        <span class="state state-blue">
                                    {{ "course_list.states.unpublished"|trans }}
                                </span>
                                    {% elseif course.status == "initiated" %}
                                        <span class="state state-yellow">
                                    {{ "course_list.states.initiated"|trans }}
                                </span>
                                    {% endif %}
                                </td>
                                <td>
                                    <a href="{{ path("elearning_courses_questions_list_lecturer", {'course_id': course.getId()}) }}">
                                        {{ "course_list.course.show_questions"|trans }}
                                        {% if questionscounts[course.getId()] > 0 %}
                                            ({{ questionscounts[course.getId()] }})
                                        {% endif %}
                                    </a>
                                </td>
                                <td>
                                    <a href="{{ path("elearning_courses_faq_questions_list_lecturer", {'course_id': course.getId()}) }}">
                                        {{ "course_list.course.faq"|trans }}
                                    </a>
                                </td>
                                <td>
                                    <a href="{{ path("elearning_courses_feedbacks_list", {'course_id': course.getId()}) }}">
                                        {{ "course_list.course.feedbacks"|trans }}
                                    </a>
                                </td>
                                <td class="text-nowrap">
                                    {% if course.status != "trash" %}
                                        <a href="{{ path("elearning_courses_new", {id: course.getId()}) }}"
                                           class="btn btn-green" title="{{ "course_list.course.edit"|trans }}">
                                            <span class="glyphicon glyphicon-pencil"
                                                                       aria-hidden="true"></span></a>
                                        {% if course.getStatus() == "unpublished" %}
                                            <a href="{{ path("elearning_courses_publish_course", {id: course.getId()}) }}"
                                               title="{{ "course_list.course.publish"|trans }}"
                                               class="btn btn-green"><span class="glyphicon glyphicon-ok"
                                                                           aria-hidden="true"></span></a>
                                        {% elseif course.getStatus() == "published" %}
                                            <a href="{{ path("elearning_courses_unpublish_course", {id: course.getId()}) }}"
                                               title="{{ "course_list.course.unpublish"|trans }}"
                                               class="btn btn-red"><span class="glyphicon glyphicon-ban-circle"
                                                                         aria-hidden="true"></span></a>
                                        {% endif %}
                                        <a href="{{ path("elearning_courses_trash_course", {id: course.getId()}) }}"
                                           title="{{ "course_list.course.trash"|trans }}"
                                           class="btn btn-red delete-course"><span class="glyphicon glyphicon-trash"
                                                                     aria-hidden="true"></span></a>
                                    {% endif %}
                                </td>
                            </tr>
                        {% endfor %}
                        </tbody>
                    </table>
                </div>
            </form>
        </div>
    </div>

{% endblock %}

{% block stylesheets %}
    {% stylesheets '@ElearningCoursesBundle/Resources/less/styles.less'
    '@ElearningCoursesBundle/Resources/less/responsive.less'
    'bundles/elearningcourses/css/sortablelist.css'
    '../app/Resources/public/css/stacktable.css' filter="cssrewrite" %}
    <link rel="stylesheet" href="{{ asset_url }}">
    {% endstylesheets %}

{% endblock %}

{% block javascripts %}
    {{ parent() }}
    <script type="text/javascript" src="https://code.jquery.com/ui/1.10.3/jquery-ui.min.js"></script>
    {% javascripts '../app/Resources/public/js/stacktable.js'
    '@ElearningCoursesBundle/Resources/public/js/sortablelist.js' %}
    <script src="{{ asset_url }}"></script>
    {% endjavascripts %}

    <script>
        jQuery(document).ready(function ($) {
            {% if is_granted('ROLE_SUPERVISOR') %}
                var sortableList = new $.JSortableList('table.courses-table tbody', 'adminForm', 'asc', '{{ path('elearning_courses_list_reorder') }}', '', '1');
            {% else %}
                $('table.courses-table').stacktable();
            {% endif %}
            $('.delete-course').click(function(e) {
                if (confirm('{{ 'course_list.delete_confirm' | trans }}')) {
                   return true;
                }
                return false;
            });
        });
    </script>
{% endblock %}
