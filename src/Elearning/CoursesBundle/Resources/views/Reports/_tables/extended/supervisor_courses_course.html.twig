{% extends "ElearningCoursesBundle:Reports/_tables:supervisor_courses_course.html.twig" %}

{% block versionlink %}
{% endblock %}

{% block table %}
    {% if listenings is empty %}
        <h3 class="no-entries">{{ "reports.supervisor_courses.no_entries"|trans }}</h3>
    {% else %}
    <div class="list-table">
        <div class="table-responsive">
            <table class="table table-striped table-bordered report-table">
                <thead>
                    <tr>
                        <th>{{ "reports.supervisor_courses.user_name"|trans }}</th>
                        <th>{{ "reports.supervisor_courses.course_name"|trans }}</th>
                        <th>{{ "reports.supervisor_courses.category"|trans }}</th>
                        <th>{{ "reports.supervisor_courses.exam_result"|trans }}</th>
                        <th>{{ "reports.supervisor_courses.start_exam"|trans }}</th>
                        <th>{{ "reports.supervisor_courses.end_exam"|trans }}</th>
                        <th>{{ "reports.supervisor_courses.available"|trans }}</th>
                        <th>{{ "reports.supervisor_courses.employed"|trans }}</th>
                        <th>{{ "reports.supervisor_courses.position"|trans }}</th>
                        <th>{{ "reports.supervisor_courses.workplace_address"|trans }}</th>
                        <th>{{ "reports.supervisor_courses.number_ckk_mpk"|trans }}</th>
                        <th>{{ "reports.supervisor_courses.departament"|trans }}</th>
                        <th>{{ "reports.supervisor_courses.superior"|trans }}</th>
                        <th>{{ "reports.supervisor_courses.region"|trans }}</th>
                        <th>{{ "reports.supervisor_courses.questions_count"|trans }}</th>
                        <th>{{ "reports.supervisor_courses.correct"|trans }}</th>
                        <th>{{ "reports.supervisor_courses.incorrect"|trans }}</th>
                    </tr>
                </thead>
                <tbody>
                    {% for listening in listenings %}
                    <tr>
                        <td>{{ listening.user.employee.getFieldValue('name') }} {{ listening.user.employee.getFieldValue('surname') }}</td>
                        <td>{{ course.name }}</td>
                        <td class="category">{{ course.category.name }}</td>
                        <td>
                            {% if listening.id in exams|keys %}
                                {{ exams[listening.id].result|number_format(2) }}%
                            {% endif %}
                        </td>
                        <td>
                            {% if listening.id in exams|keys %}
                                {{ exams[listening.id].starttime | date('Y-m-d H:i') }}
                            {% endif %}
                        </td>
                        <td>
                            {% if listening.id in exams|keys %}
                                {{ exams[listening.id].endtime | date('Y-m-d H:i') }}
                            {% endif %}
                        </td>
                        <td>                                                        
                            {{ listening.user.enabled ? 
								'new_employee.fields.available_choices.available'|trans : 
								'new_employee.fields.available_choices.unavailable'|trans 
							}}
                        </td>
                        <td>
                            {% set employed = listening.user.employee.getFieldValue('employed') %}
                            {% if employed %}
                                {{ ('new_employee.fields.employed_choices.'~employed)|trans }}
                            {% endif %}
                        </td>
                        <td>{{ listening.user.employee.getFieldValue('position') }}</td>
                        <td>{{ listening.user.employee.getFieldValue('address') }}</td>
                        <td>{{ listening.user.employee.getFieldValue('ckk_number')|default('-') }}/{{ listening.user.employee.getFieldValue('mpk_number')|default('-') }}</td>
                        <td>{{ listening.user.employee.getFieldValue('departament') }}</td>
                        <td>
                            {% if listening.user.employee.id in employeeAdmins|keys %}
                                {% for admin in employeeAdmins[listening.user.employee.id] %}
                                    {% if admin.name %}
                                        {{ admin.name }} {{ admin.surname }}{{ not loop.last ? ',' : '' }}
                                    {% else %}
                                        {{ admin.username }}{{ not loop.last ? ',' : '' }}
                                    {% endif %}
                                {% endfor %}
                            {% endif %}
                        </td>
                        <td>{{ listening.user.employee.getFieldValue('region') }}</td>
                        <td>
                            {{ listening.questions|length }}
                        </td>
                        <td>
                            {% if listening.id in exams|keys %}
                                {{ exams[listening.id].correct }}
                            {% endif %}
                        </td>
                        <td>
                            {% if listening.id in exams|keys %}
                                {{ exams[listening.id].incorrect }}
                            {% endif %}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% if view == 'html' %}
            <div class="pagination">
                {{ knp_pagination_render(listenings) }}
            </div>
        {% endif %}
    </div>
    {% endif %}
{% endblock %}