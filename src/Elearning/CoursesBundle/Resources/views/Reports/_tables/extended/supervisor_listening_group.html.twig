{% extends "ElearningCoursesBundle:Reports/_tables:supervisor_listening_group.html.twig" %}

{% block versionlink %}
{% endblock %}

{% block table %}
    {% if employees is empty %}
        <h3 class="no-entries">{{ "reports.supervisor_listening.no_entries"|trans }}</h3>
    {% else %}
        <div class="list-table">
            <div class="table-responsive">
                <table class="table table-striped table-bordered report-table">
                    <thead>
                    <tr>
                        <th width="200">{{ "reports.supervisor_listening_group.name"|trans }}</th>
                        <th>{{ "reports.supervisor_listening_group.course_count"|trans }}</th>
                        <th>{{ "reports.supervisor_listening_group.completed_course_count"|trans }}</th>
                        <th>{{ "reports.supervisor_listening_group.average_exam_result"|trans }}</th>
                        <th>{{ "reports.supervisor_listening_group.last_action"|trans }}</th>
                        <th>{{ "reports.supervisor_courses.available"|trans }}</th>
                        <th>{{ "reports.supervisor_courses.employed"|trans }}</th>
                        <th>{{ "reports.supervisor_courses.position"|trans }}</th>
                        <th>{{ "reports.supervisor_courses.workplace_address"|trans }}</th>
                        <th>{{ "reports.supervisor_courses.number_ckk_mpk"|trans }}</th>
                        <th>{{ "reports.supervisor_courses.departament"|trans }}</th>
                        <th>{{ "reports.supervisor_courses.superior"|trans }}</th>
                        <th>{{ "reports.supervisor_courses.region"|trans }}</th>
                        <th>{{ "reports.supervisor_courses.questions_count"|trans }}</th>
                        {% if view == 'html' %}
                            <th>{{ "reports.supervisor_listening_group.detail"|trans }}</th>
                        {% endif %}
                    </tr>
                    </thead>
                    <tbody>
                    {% for employee in employees %}
                        <tr>
                            <td>{{ employee.getFieldValue('name') }} {{ employee.getFieldValue('surname') }}</td>
                            <td>{{ employee.id in coursecounts|keys ? coursecounts[employee.id]['num'] : "0" }}</td>
                            <td>{{ employee.id in completedcoursecounts|keys ? completedcoursecounts[employee.id]['num'] : "0" }}</td>
                            <td>{{ employee.id in avgexamresults|keys ? avgexamresults[employee.id]['average']|number_format(2) : "0" }}
                                %
                            </td>
                            <td>{{ employee.id in lastactions|keys ? lastactions[employee.id]['last_action'] : "0" }}</td>
                            <td>
                                {{ employee.user.enabled ? 
									'new_employee.fields.available_choices.available'|trans : 
									'new_employee.fields.available_choices.unavailable'|trans 
								}}
                            </td>
                            <td>
                                {% set employed = employee.getFieldValue('employed') %}
                                {% if employed %}
                                    {{ ('new_employee.fields.employed_choices.'~employed)|trans }}
                                {% endif %}
                            </td>
                            <td>{{ employee.getFieldValue('position') }}</td>
                            <td>{{ employee.getFieldValue('address') }}</td>
                            <td>{{ employee.getFieldValue('ckk_number')|default('-') }}/{{ employee.getFieldValue('mpk_number')|default('-') }}</td>
                            <td>{{ employee.getFieldValue('departament') }}</td>
                            <td>
                                {% if employee.id in employeeAdmins|keys %}
                                    {% for admin in employeeAdmins[employee.id] %}
                                        {% if admin.name %}
                                            {{ admin.name }} {{ admin.surname }}{{ not loop.last ? ',' : '' }}
                                        {% else %}
                                            {{ admin.username }}{{ not loop.last ? ',' : '' }}
                                        {% endif %}
                                    {% endfor %}
                                {% endif %}
                            </td>
                            <td>{{ employee.getFieldValue('region') }}</td>
                            <td>
                                {{ employee.id in questions|keys ? questions[employee.id] : 0 }}
                            </td>

                            {% if view == 'html' %}
                                <td>
                                    <a href="{{ path("elearning_courses_report_supervisor_listening_employee", {group_id:group.id, employee_id: employee.id}) }}">{{ "reports.supervisor_listening.detail"|trans }}</a>
                                </td>
                            {% endif %}
                        </tr>
                    {% endfor %}
                    </tbody>
                </table>
            </div>
            {% if view == 'html' %}
                <div class="pagination">
                    {{ knp_pagination_render(employees) }}
                </div>
            {% endif %}
        </div>
    {% endif %}
{% endblock %}