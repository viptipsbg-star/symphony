{% extends view == 'html' ? "ElearningCoursesBundle:Reports:supervisor_report.html.twig" : "ElearningCoursesBundle:Reports:xlsx_base.html.twig" %}

{% block reporttitle %}
    {{ "reports.supervisor_listening.title"|trans }}
{% endblock %}

{% block xlsxlink %}
    <a href="{{ path("elearning_course_report_manager_groups", {'view' : 'xlsx'}) }}" class="btn btn-orange">{{ "reports.attendance.export_excell"|trans }}</a>
{% endblock %}

{% block table %}

        <div class="groups-report">

            {% if groups is empty %}
                <h3 class="no-entries">{{ "reports.supervisor_listening.no_entries"|trans }}</h3>
            {% endif %}

            {% if view == 'html' %}
                {% if groups|length > 1 %}
                    <ul class="nav nav-tabs" role="tablist">
                        {% for group in groups %}
                        <li role="presentation"{% if loop.index == 1 %} class="active"{% endif %}>
                            <a href="#group-employees-{{ group.id }}" aria-controls="group-employees-{{ group.id }}" role="tab" data-toggle="tab">
                                {{ group.title }}
                            </a>
                        </li>
                        {% endfor %}
                    </ul>
                {% endif %}
            {% endif %}

            <div class="tab-content">
            {% for group in groups %}
                {% set params = reportparams[group.id] %}
                <div role="tabpanel" class="tab-pane group-employees {% if loop.index == 1 %}active{% endif %}" id="group-employees-{{ group.id }}">
                {% if params['employees'] is empty %}
                    <h3 class="no-entries">{{ "reports.supervisor_listening.no_entries"|trans }}</h3>
                {% else %}
                    {% if view == 'xlsx' %}
                        <h3>{{ group.title }}</h3>
                    {% endif %}
                    <div class="list-table">
                        <table class="table table-striped table-bordered">
                            <thead>
                                <tr>
                                    <th width="200">{{ "reports.supervisor_listening_group.name"|trans }}</th>
                                    <th>{{ "reports.supervisor_listening_group.course_count"|trans }}</th>
                                    <th>{{ "reports.supervisor_listening_group.completed_course_count"|trans }}</th>
                                    <th>{{ "reports.supervisor_listening_group.average_exam_result"|trans }}</th>
                                    <th>{{ "reports.supervisor_listening_group.last_action"|trans }}</th>
                                    {% if view == 'html' %}
                                        <th>{{ "reports.supervisor_listening_group.detail"|trans }}</th>
                                    {% endif %}
                                </tr>
                            </thead>
                            <tbody>
                                {% for employee in params['employees'] %}
                                <tr>
                                    <td>{{ employee.getFieldValue('name') }} {{ employee.getFieldValue('surname') }}</td>
                                    <td>{{ employee.id in params['coursecounts']|keys ? params['coursecounts'][employee.id]['num'] : "0" }}</td>
                                    <td>{{ employee.id in params['completedcoursecounts']|keys ? params['completedcoursecounts'][employee.id]['num'] : "0" }}</td>
                                    <td>{{ employee.id in params['avgexamresults']|keys ? params['avgexamresults'][employee.id]['average']|number_format(2) : "0" }}%</td>
                                    <td>{{ employee.id in params['lastactions']|keys ? params['lastactions'][employee.id]['last_action'] : "0" }}</td>
                                    {% if view == 'html' %}
                                        <td>
                                            <a href="{{ path("elearning_courses_report_supervisor_listening_employee", {group_id:group.id, employee_id: employee.id}) }}">{{ "reports.supervisor_listening.detail"|trans }}</a>
                                        </td>
                                    {% endif %}
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                {% endif %}
                </div>
            {% endfor %}
            </div>
        </div>

{% endblock %}
