{% extends "bodybase.html.twig" %}

{% block bodycontainer %}
<h1>{{ "reports.manager_courses.title"|trans }}</h1>
<div class="content-container">
    <div class="body-panel">
        {% if listenings is empty %}
            <h3 class="no-entries">{{ "reports.lecturer_courses.no_entries"|trans }}
        {% else %}
        <div class="list-table manager-course-listening">
            <table class="table table-striped table-bordered">
                <thead>
                    <tr>
                        <th>{{ "reports.manager_courses.user_name"|trans }}</th>
                        <th>{{ "reports.manager_courses.course_name"|trans }}</th>
                        <th>{{ "reports.manager_courses.assigned_time"|trans }}</th>
                        <th>{{ "reports.manager_courses.start_time"|trans }}</th>
                        <th>{{ "reports.manager_courses.completed_time"|trans }}</th>
                        <th>{{ "reports.manager_courses.exam_result"|trans }}</th>
                        <th>{{ "reports.manager_courses.questions_count"|trans }}</th>
                        <th>{{ "reports.manager_courses.certificate"|trans }}</th>
                        <th>{{ "reports.manager_courses.detail"|trans }}</th>
                    </tr>
                </thead>
                <tbody>
                    {% for listening in listenings %}
                    <tr>
                        <td>{{ listening.user.employee.getFieldValue("name") }} {{ listening.user.employee.getFieldValue("surname") }}</td>
                        <td>{{ listening.course.name }}</td>
                        <td>{{ listening.created|date("Y-m-d H:i:s") }}</td>
                        <td>{{ listening.started|date("Y-m-d H:i:s") }}</td>
                        <td>
                        {% if listening.completed %}
                            {{ listening.lastListen|date("Y-m-d H:i:s") }}
                        {% endif %}
                        </td>
                        <td>
                            {% if listening.examAttempts is not empty %}
                                {% for attempt in listening.examAttempts %}
                                    {% if attempt.endtime %}
                                        <span class="exam-attempt {% if attempt.passed %}passed{% elseif attempt.passed == false %}failed{% endif %}">
                                            {{ attempt.starttime|date("Y-m-d") }}
                                            {% if attempt.result is not empty %}
                                             - {{ attempt.result }}%
                                            {% endif %}
                                        </span>
                                    {% endif %}
                                {% endfor %}
                            {% endif %}
                        </td>
                        <td>{{ listening.questions|length }}</td>
                        <td>
                            {% if listening.isCoursePassed() %}
                            <a href="{{ path("elearning_course_certificate", {listening_id: listening.id}) }}" target="_blank"><img src="{{ asset("bundles/elearningcourses/images/pdf_ico.png") }}"/></a>
                            {% endif %}
                        </td>
                        <td><a href="{{ path("elearning_course_report_manager_listening_employee", {listening_id: listening.id}) }}">{{ "reports.manager_courses.detail"|trans }}</a></td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            <div class="pagination">
                {{ knp_pagination_render(listenings) }}
            </div>
        </div>
        {% endif %}
    </div>
</div>

{% endblock %}

{% block stylesheets %}
    {% stylesheets '@ElearningCoursesBundle/Resources/less/styles.less'
    '@ElearningCoursesBundle/Resources/less/responsive.less' filter="cssrewrite" %}
        <link rel="stylesheet" href="{{ asset_url }}">
    {% endstylesheets %}

{% endblock %}
